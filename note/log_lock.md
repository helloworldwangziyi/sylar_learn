# 给日志模块加上锁

为啥，很简单我们的日志模块并没有设置线程同步机制，所以在多线程的状态下，日志模块就会出现问题，所以我们需要给日志模块加上锁。

怎么加呢，很简单，哪里会涉及到输出，哪里就需要加锁，所以只要涉及toYamlString()和log()函数的类
就需要加锁。

我们现在才刚刚解决第一个难点，给谁加锁。
那么第二个问题就是怎么加,我们已经封装了各种锁，所以我们只需要在需要加锁的地方加上锁就行了。

只需要注意一点，就是我们封装锁的思路是采用RAII，所以我们的锁就是锁住了当前锁所在的作用域，也就是说我们需要确定那些作用域需要加锁即可。看一个例子
```c++
{
    RWMutexType::ReadLock lock(m_mutex);
    if(v == m_val) {
        return;
    }
    for(auto& i : m_cbs) {
        i.second(m_val, v);
    }
}
```
我们使用了读写锁，所以我们需要确定的是读锁的作用域，所以我们只需要在读锁的作用域加锁就行了。这里作用域就是{}中的内容。我们出作用域就会释放锁。